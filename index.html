<!doctype html>
const awayPlayers = (players[away] || []).map(p=>`<li>${p}</li>`).join('');
const homePlayers = (players[home] || []).map(p=>`<li>${p}</li>`).join('');


const el = document.createElement('article');
el.className = 'rounded-2xl border border-slate-200 dark:border-slate-800 bg-white/70 dark:bg-slate-900/70 p-3 sm:p-4 shadow-sm';
el.innerHTML = `
<div class="flex items-center justify-between gap-2">
<div class="flex items-center gap-2 sm:gap-3">
${helmetSVG(awayMeta.primary)}
<span style="color:${awayMeta.primary}">${awayMeta.name}</span>
</div>
<div class="font-bold">@</div>
<div class="flex items-center gap-2 sm:gap-3">
<span style="color:${homeMeta.primary}">${homeMeta.name}</span>
${helmetSVG(homeMeta.primary)}
</div>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-3">
<div>
<h4 class="text-xs uppercase tracking-wider text-slate-500 mb-1">Tes joueurs – ${away}</h4>
${awayPlayers ? `<ul class="text-sm list-disc pl-5">${awayPlayers}</ul>` : `<div class="text-sm italic text-slate-400">Aucun joueur</div>`}
</div>
<div>
<h4 class="text-xs uppercase tracking-wider text-slate-500 mb-1">Tes joueurs – ${home}</h4>
${homePlayers ? `<ul class="text-sm list-disc pl-5">${homePlayers}</ul>` : `<div class="text-sm italic text-slate-400">Aucun joueur</div>`}
</div>
</div>
`;
return el;
}


function renderWeek(week, schedule, players){
$matches.innerHTML = '';
const games = schedule.filter(g => Number(g.week) === Number(week));
if(!games.length){
$matches.innerHTML = `<div class="text-sm text-slate-500">Aucun match pour la Week ${week}.</div>`;
return;
}
games.forEach(g => $matches.appendChild(renderMatch(g, players)) );
}


async function loadJSON(path){
try{
const res = await fetch(path, {cache:'no-store'});
if(!res.ok) throw new Error(`${path} → HTTP ${res.status}`);
return await res.json();
}catch(err){
console.error('Erreur JSON', path, err);
$status.textContent = `Erreur de chargement de ${path} : ${err.message}`;
return null;
}
}


(async function init(){
$status.textContent = 'Chargement des données…';
const [schedule, players] = await Promise.all([
loadJSON('schedule.json'),
loadJSON('players.json')
]);
if(!schedule || !players){
$status.textContent = 'Impossible de charger les données. Vérifie schedule.json et players.json.';
return;
}


// Renseigner le select des Weeks
const weeks = Array.from(new Set(schedule.map(g => Number(g.week)).filter(n => !isNaN(n)))).sort((a,b)=>a-b);
$weekSelect.innerHTML = '';
if(!weeks.length){
$status.textContent = 'Aucune semaine trouvée dans schedule.json.';
return;
}
weeks.forEach(w => {
const o = document.createElement('option');
o.value = String(w);
o.textContent = 'Week ' + w;
$weekSelect.appendChild(o);
});


// Par défaut : première semaine
$weekSelect.value = String(weeks[0]);
renderWeek(weeks[0], schedule, players);


$weekSelect.addEventListener('change', (e)=>{
renderWeek(e.target.value, schedule, players);
});


$status.textContent = '';
})();
</script>
</body>
</html>
